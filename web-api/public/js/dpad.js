!function(){"use strict";class t{constructor(t){this.focusState=!1,this.element=t,this.resetNeighbors()}getElement(){return this.element}focus(){this.element.focus()}resetNeighbors(){this.neighbors={top:null,bottom:null,left:null,right:null}}setTopFocusItemIndex(t){this.neighbors.top=t}getTopFocusItemIndex(){return this.neighbors.top}setBottomFocusItemIndex(t){this.neighbors.bottom=t}getBottomFocusItemIndex(){return this.neighbors.bottom}setLeftFocusItemIndex(t){this.neighbors.left=t}getLeftFocusItemIndex(){return this.neighbors.left}setRightFocusItemIndex(t){this.neighbors.right=t}getRightFocusItemIndex(){return this.neighbors.right}isFocusable(){if("none"===this.element.style.display||"hidden"===this.element.style.visibility)return!1;let t=this.element.getAttribute("tabindex");if(!t)return!1;try{return parseInt(t,10)>-1}catch(t){}return!1}getMetrics(){var t=this.element.getBoundingClientRect();return{width:t.width,height:t.height,left:t.left,right:t.left+t.width,top:t.top,bottom:t.top+t.height,center:{x:t.left+t.width/2,y:t.top+t.height/2}}}onItemClickStateChange(t){}}function e(t,e){return Math.floor(Math.sqrt(t*t+e*e))}class s{constructor(){this.focusableItems=[],this.currentlyFocusedItem=null,this.enabled=!1,this.getRightDistance=function(t,e){return this.horizontalDistance(t,e,t,e)},this.focusableItems=[],this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.enable()}disable(){this.enabled&&(document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.enabled=!1)}enable(){this.enabled||(document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.enabled=!0)}findFocusableItems(){const e=document.querySelectorAll(".dpad-focusable");for(const s of e)this.addFocusableItem(new t(s))}addFocusableItem(t){this.focusableItems.push(t)}getFocusableItems(){return this.focusableItems}getFocusableItem(t){return t>=this.focusableItems.length||t<0?null:this.focusableItems[t]}setCurrentFocusItem(t){const e=this.getFocusableItem(t);this.currentlyFocusedItem=e,this.currentlyFocusedItem&&this.currentlyFocusedItem.focus()}update(){this.findFocusableItems();for(const t of this.focusableItems)t.isFocusable()&&this.updateNeighbors(t)}moveFocus(t){if(this.currentlyFocusedItem){var e=null;0===t.y?e=t.x>0?this.currentlyFocusedItem.getRightFocusItemIndex():this.currentlyFocusedItem.getLeftFocusItemIndex():0===t.x&&(e=t.y>0?this.currentlyFocusedItem.getTopFocusItemIndex():this.currentlyFocusedItem.getBottomFocusItemIndex()),null!==e&&this.setCurrentFocusItem(e)}else this.focusableItems.length>0&&this.setCurrentFocusItem(0)}updateNeighbors(t){const e=t.getMetrics(),s=this.focusableItems.length;let n,o,i,r;for(var c=0;c<s;c++){var h=this.getFocusableItem(c);if(!h.isFocusable()||h===t)continue;const s=h.getMetrics(),a=this.getTopDistance(e,s),u=this.getBottomDistance(e,s),l=this.getLeftDistance(e,s),d=this.getRightDistance(e,s);null!==a&&(void 0===n||n>a)&&(n=a,t.setTopFocusItemIndex(c)),null!==u&&(void 0===o||o>u)&&(o=u,t.setBottomFocusItemIndex(c)),null!==l&&(void 0===i||i>l)&&(i=l,t.setLeftFocusItemIndex(c)),null!==d&&(void 0===r||r>d)&&(r=d,t.setRightFocusItemIndex(c))}}verticalDistance(t,s,n,o){if(n.bottom>o.top)return null;const i=Math.abs(t.center.x-s.left),r=Math.abs(t.center.x-s.right),c=Math.min(Math.abs(t.center.x-s.left),Math.abs(t.center.x-s.center.x),Math.abs(t.center.x-s.right)),h=o.center.y-n.center.y,a=Math.atan(h/i)*(180/Math.PI),u=Math.atan(h/r)*(180/Math.PI);return a>=0&&u<=180?e(c,h):null}getTopDistance(t,e){return this.verticalDistance(t,e,e,t)}getBottomDistance(t,e){return this.verticalDistance(t,e,t,e)}horizontalDistance(t,s,n,o){if(n.right>o.left)return null;const i=Math.abs(t.center.y-s.top),r=Math.abs(t.center.y-s.bottom),c=o.center.x-n.center.x,h=Math.min(Math.abs(t.center.y-s.top),Math.abs(t.center.y-s.center.y),Math.abs(t.center.y-s.bottom));var a=Math.atan(c/i)*(180/Math.PI),u=Math.atan(c/r)*(180/Math.PI);return a>=0&&u<=180?e(c,h):null}getLeftDistance(t,e){return this.horizontalDistance(t,e,e,t)}onKeyDown(t){switch(t.keyCode){case 9:break;case 37:t.preventDefault(),this.moveFocus({x:-1,y:0});break;case 38:t.preventDefault(),this.moveFocus({x:0,y:1});break;case 39:t.preventDefault(),this.moveFocus({x:1,y:0});break;case 40:t.preventDefault(),this.moveFocus({x:0,y:-1});break;case 13:case 32:t.preventDefault(),this.currentlyFocusedItem&&this.currentlyFocusedItem.onItemClickStateChange(!0)}}onKeyUp(t){switch(t.keyCode){case 13:t.preventDefault(),this.currentlyFocusedItem&&this.currentlyFocusedItem.onItemClickStateChange(!1)}}}window.addEventListener("load",()=>{window.dpad=window.dpad||new s,window.dpad.update()}),window.addEventListener("resize",()=>{window.dpad&&window.dpad.update()})}();
//# sourceMappingURL=dpad.js.map